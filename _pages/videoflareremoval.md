---
layout: page
permalink: /research/videoflareremoval
title:videoflareremoval
nav:false
---
# Video Flare Synthesis and Removal

### 1. 杂散光产生的原理
透镜系统中杂散光可以分为两个主要类别：由散射引起的和由反射引起的
通常情况下，透镜会沿着未知的方向散射和反射光线，导致杂散光的产生。通常情况下，这种散射和反射的光线强度都很小，不会对图像产生过多影响。但是当入射光强度较大时，特别是比其他位置的光强得多时，这样的散射和反射光线的影响就会增大，进而对图像产生可见的影响。
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/7e37197f-ff0c-4c12-a014-d504e18b602a)

#### 1.1 散射引起的杂散光
在理想情况下，透镜应该仅发生折射，将入射的光线折射到相平面上，而在实际情况中，散射现象的产生主要是由于透镜的瑕疵，如划痕、磨损、灰尘等。
在这当中，划痕的存在会导致图像中出现由图像中光源出发，向四周呈条纹状发射的散射光，而灰尘的存在会导致“彩虹样”散射光的出现。
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/79cc1415-faee-48dc-85e7-ad1de40c8b68)
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/614e7a2c-6bca-4af4-a3a2-43d7e40afde4)


#### 1.2 反射引起的杂散光
由于常见的镜头是由多个平面镜、透镜组成的，因此，在各个光学器件之间存在着一定的反射现象（约4%）。光线在光学器件之间经历多次反射后，可能会反射到像平面上的任意位置，这一反射光与光源的入射角高度相关，但与绕着主光轴转动的角度无关。
反射引起的杂散光有着较为特殊的几何性质：
首先，其形状与孔径的形状相同（多为5-16边形）
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/dd0efb1a-d1f3-41d2-b2aa-ba614175989b)

其次，其排列在光源中心和主光轴所成直线上：
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/d1b9dd2d-05f4-4c24-97e4-7e44e38e1456)

再次，反射引起的杂散光存在一定的伸缩，这一伸缩的系数与多边形杂散光中心到主光轴距离与到光源距离的比例有关；
除此以外，散射引起的杂散光还因为空气散射等原因，存在边缘模糊的现象；
### 2. 图像去杂散光算法
目前，图像去杂散光领域已有多篇论文研究，绝大多数都采用深度学习的方法，方法较多且较成熟；其大多遵循先合成杂散光，再训练神经网络将其去除的办法。对于视频去杂散光而言，虽然视频可以视作许多帧图像的结合，从合成杂散光上讲，这样的方法没有考虑时序性，使得无法进行视频杂散光合成，即不知道某一帧中的物体在下一帧如何移动，进而也就不知道光源位置该如何变化。
从去除杂散光上讲，图像去杂散光算法很容易引起帧间的时空不一致性，这是因为杂散光对图像的亮度和对比度有较大的影响，基于学习的方法对图像进行处理的话，很容易使其本身场景的亮度和对比度发生漂移，而偏移量很大程度取决于模型和场景内容，从而导致不同帧间可能存在较大的亮度及对比度差异，极大程度影响视觉观感和机器感知。
去除杂散光的任务和去噪，超分辨还不一样，这两个任务对帧间亮度等的影响较小，毕竟细节和噪声等细粒度信息对图像整体的影响并非致命的，不像杂散光是直接对图像整体有偏移，帧间差异就很明显且致命了，这会导致视频出现严重的跳帧等现象。
### 3. 现有杂散光数据集存在的问题
现有视频集并未按照相机是否移动、光源是否移动等性质进行分类。且目前并不存在含杂散光的视频数据集，因此，我们需要进行杂散光视频集的合成。
### 4. 杂散光视频集的合成
总的来说，根据相机和场景的运动情况与杂散光的性质，我们按照如下方法生成杂散光：
相机动，光源动杂散光根据相对位置计算，反射光和散射光均变
相机动，光源不动杂散光根据相对位置计算，且反射光变化大，散射光变化小
相机不动，光源动（把光源设置在运动物体上）杂散光变化，反射光和散射光均变化
相机不动，光源不动（设置在背景上）杂散光不变
在视频集上合成杂散光的过程中，我们需要根据视频集前后两帧的光流预测其下一帧的杂散光位置该如何变化，在生成视频集光流时，我们采用目前效果最好的FlowFormer光流估计法，进行视频集的光流合成
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/b1d27d47-2683-4896-b850-7dc4d71aa10d)

在这之后，我们按照杂散光的物理性质与几何性质，给定光源位置，合成随着光源位置和相机位置变化的杂散光视频集
![image](https://github.com/TianwenZhou/ownwebsite/assets/100060410/85c1a2b7-bcaf-4319-b1b9-a7227f3982d4)
